machine:
  services:
  - docker
  ghc:
    version: 7.8.4
  environment:
    PATH: ~/.local/bin:$PATH

dependencies:
  override:
  # Even though we have stack in docker image, we still need it on CI
  - mkdir -p ~/.local/bin
  - curl -L https://github.com/commercialhaskell/stack/releases/download/v0.1.3.0/stack-0.1.3.0-x86_64-linux.gz | gunzip > ~/.local/bin/stack
  - chmod a+x ~/.local/bin/stack
  - (cd /; stack --no-terminal setup; stack --no-terminal upgrade --git)
  # should run inside docker
  - stack --no-terminal docker pull
  - stack --no-terminal --docker build --only-snapshot --prefetch --test --bench --haddock

  cache_directories:
  - "~/.stack/"

test:
  override:
  - stack --no-terminal --docker build --haddock --test --bench
